<title>Toast</title><meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no"><style>canvas{left:50%;max-height:100%;max-width:100%;position:fixed;top:50%;transform:translate(-50%,-50%);}</style><canvas id="canvas"></canvas><script>"use strict";var t={parts:[{name:"wizard",bounds:[0,43,0,35,0,4],size:[44,36],data:[-20,0,-4,29,-39,0,29,-4,1,29,-38,0,29,-4,1,29,-37,0,29,-6,1,29,-36,0,29,-6,1,29,-36,0,29,-6,1,29,-36,0,29,-6,1,29,-36,0,29,-6,1,29,-22,0,-2,29,30,-12,0,29,-4,1,29,-12,0,30,-2,29,-6,0,-2,28,-2,29,30,-3,29,-6,0,30,-10,29,30,-6,0,-3,29,30,-2,29,-2,28,-5,0,28,-2,29,30,-10,29,-3,30,-4,29,-3,30,-10,29,30,-2,29,28,-7,0,-2,29,30,-13,29,-4,30,-13,29,30,-2,29,-8,0,29,30,-32,29,30,29,-8,0,29,30,-12,0,-8,29,-12,0,30,29,-22,0,30,-6,29,30,-36,0,30,-6,29,30,-36,0,29,30,-4,29,30,29,-36,0,29,30,-4,29,30,29,-36,0,29,30,-4,29,30,29,-36,0,29,30,-4,29,30,29,-36,0,29,30,-4,29,30,29,-36,0,30,-6,29,30,-35,0,30,-8,29,30,-34,0,-10,29,-34,0,-10,29,-34,0,-10,29,-34,0,-10,29,-34,0,-10,29,-33,0,-12,29,-32,0,-12,29,-32,0,-12,29,-32,0,-12,30,-32,0,-12,29,-32,0,-12,29,-34,0,-2,28,-4,0,-2,28,-36,0,-2,28,-4,0,-2,28,-417,0,-2,33,-34,0,-2,33,-5,0,-4,33,-32,0,-4,33,-4,0,-4,33,-32,0,-4,33,-5,0,-2,33,-34,0,-2,33,-1325,0,-4,33,-32,0,-4,33,-3,0,-6,33,-30,0,-6,33,0,-8,33,-28,0,-11,33,-2,32,-3,33,-28,0,-3,33,-2,32,-6,33,-2,32,-3,33,-28,0,-3,33,-2,32,-11,33,-28,0,-8,33,0,-6,33,-30,0,-6,33,-3,0,-4,33,-32,0,-4,33,-1236,0,-4,33,-32,0,-4,33,-3,0,-6,33,-30,0,-6,33,0,-3,33,-2,32,-3,33,-28,0,-3,33,-2,32,-5,33,-4,32,-2,33,-28,0,-2,33,-4,32,-4,33,-4,32,-2,33,-28,0,-2,33,-4,32,-5,33,-2,32,-3,33,-28,0,-3,33,-2,32,-3,33,0,-6,33,-30,0,-6,33,-3,0,-4,33,-32,0,-4,33,-1236,0,-4,33,-32,0,-4,33,-3,0,-2,33,-2,32,-2,33,-30,0,-2,33,-2,32,-2,33,0,-2,33,-4,32,-2,33,-28,0,-2,33,-4,32,-3,33,-6,32,33,-28,0,33,-6,32,-2,33,-6,32,33,-28,0,33,-6,32,-3,33,-4,32,-2,33,-28,0,-2,33,-4,32,-2,33,0,-2,33,-2,32,-2,33,-30,0,-2,33,-2,32,-2,33,-3,0,-4,33,-32,0,-4,33,-926,0]},{name:"sparkles",bounds:[0,6,0,6,0,1],size:[7,7],data:[-3,0,33,-6,0,33,-5,0,33,32,33,-2,0,-2,33,-3,32,-2,33,-2,0,33,32,33,-5,0,33,-6,0,33,-6,0,32,-6,0,32,-5,0,32,31,32,-2,0,-2,32,-3,31,-2,32,-2,0,32,31,32,-5,0,32,-6,0,32,-3,0]},{name:"planet",bounds:[0,115,0,84,0,0],size:[116,85],data:[-86,0,-8,6,-100,0,-20,6,-87,0,-33,6,-69,0,-8,33,-4,0,-11,6,5,-2,6,5,-2,6,-2,5,-2,6,5,-2,6,5,6,5,-11,6,-60,0,-19,33,-6,6,-2,5,-20,6,5,-10,6,-54,0,-26,33,-28,6,5,-9,6,-49,0,-30,33,5,-6,6,-3,5,-2,6,5,-2,6,5,-2,6,5,-11,6,5,-8,6,-45,0,-35,33,-17,6,5,-2,6,5,-8,6,5,-7,6,-41,0,29,-39,33,-20,6,5,-7,6,5,-7,6,-40,0,29,-16,33,-3,29,-21,33,6,5,-2,6,5,6,5,-2,6,5,-10,6,5,-14,6,-39,0,-2,29,-12,33,-2,29,-3,33,-3,29,-21,33,-11,6,5,-2,6,5,-6,6,5,-6,6,5,-6,6,-37,0,29,-14,33,29,-3,33,-4,29,-23,33,-7,0,-14,6,5,-12,6,-34,0,-18,33,29,-2,33,-4,29,-24,33,-10,0,-4,6,5,-6,6,5,-5,6,5,-5,6,-32,0,29,-19,33,29,-3,33,-3,29,-11,33,29,-13,33,-10,0,-11,6,5,-11,6,-31,0,-38,33,29,-14,33,-10,0,-4,6,5,-17,6,-30,0,-39,33,29,-15,33,-11,0,-10,6,5,-4,6,5,-4,6,-29,0,-55,33,-2,29,-11,0,-3,6,5,-6,6,5,-8,6,-29,0,-57,33,29,-10,0,-19,6,-28,0,-9,33,-2,29,-42,33,29,-4,33,29,-11,0,-4,6,5,-5,6,5,-3,6,5,-3,6,-27,0,-7,33,-2,29,-2,33,-2,29,-41,33,-2,29,-5,33,-10,0,-18,6,-26,0,-8,33,29,-3,33,-2,29,-42,33,-2,29,-5,33,-10,0,-9,6,5,-7,6,-25,0,-8,33,-2,29,-3,33,-2,29,-43,33,-3,29,-3,33,-11,0,-3,6,5,-8,6,5,-3,6,-25,0,-8,33,-3,29,-2,33,-2,29,-46,33,29,-3,33,-10,0,-4,6,5,-3,6,5,-7,6,-24,0,-10,33,-2,29,-25,33,-2,29,33,-3,29,-23,33,-10,0,-8,6,5,-3,6,5,-3,6,-24,0,-37,33,29,-2,33,-3,29,-24,33,-9,0,-16,6,-23,0,-37,33,-2,29,-3,33,-2,29,-24,33,-9,0,-4,6,5,-11,6,-23,0,-23,33,29,-13,33,29,-4,33,-2,29,-25,33,-7,0,-12,6,5,-3,6,-23,0,-22,33,-2,29,-15,33,29,-4,33,29,-26,33,-6,0,-5,6,5,-3,6,5,-6,6,-22,0,5,-39,33,-3,29,-29,33,-6,0,-15,6,-22,0,-2,5,-72,33,-5,0,-4,6,5,-10,6,-21,0,-2,5,-54,33,29,-18,33,-4,0,-8,6,5,-4,6,5,-2,6,-20,0,-3,5,-73,33,-4,0,-4,6,5,-10,6,-20,0,-4,5,-73,33,-4,0,-7,6,5,-7,6,-19,0,-5,5,-9,33,29,-54,33,29,-9,33,-2,0,-15,6,-19,0,-4,5,4,-10,33,29,-2,33,29,-50,33,-2,29,-9,33,-2,0,-3,6,5,-3,6,5,-4,6,5,-2,6,-18,0,-4,5,4,5,-10,33,29,-64,33,0,-7,6,5,-7,6,-18,0,-7,5,-25,33,-4,29,-12,33,29,-25,33,-2,29,-6,33,0,-15,6,-18,0,-2,5,4,-4,5,29,-22,33,29,-2,33,-4,29,-11,33,29,-2,33,29,-30,33,-12,6,5,-2,6,-18,0,-7,5,4,29,-21,33,-2,29,-4,33,-3,29,-10,33,29,-33,33,-4,6,5,-2,6,5,-6,6,-18,0,-7,5,4,5,-2,29,-19,33,29,-7,33,-2,29,-30,33,29,-12,33,-4,6,5,-9,6,-18,0,-3,5,4,-6,5,-2,29,-19,33,-2,29,-6,33,-2,29,-27,33,-2,29,33,-2,29,-10,33,-8,6,5,-3,6,5,-2,6,-17,0,-11,5,-2,29,-20,33,29,-6,33,-2,29,-27,33,29,-2,33,-2,29,-10,33,-14,6,-18,0,-2,5,4,-4,5,4,-3,5,-3,29,-19,33,29,-6,33,-2,29,-27,33,29,33,-2,29,-10,33,-4,6,5,-10,6,-17,0,-11,5,4,-3,29,-19,33,-2,29,-4,33,-3,29,-40,33,-8,6,5,-3,6,5,-2,6,-17,0,-8,5,4,-4,5,-4,29,-19,33,-2,29,-3,33,-2,29,-40,33,-8,6,5,-6,6,-17,0,-4,5,4,-9,5,-5,29,-19,33,-2,29,-17,33,29,33,29,-23,33,-4,6,5,-3,6,5,-6,6,-18,0,-7,5,4,-5,5,0,-5,29,-10,33,29,-27,33,29,33,29,-22,33,-13,6,5,6,-18,0,-3,5,4,-7,5,4,-2,5,-2,0,-5,29,-2,33,-2,29,-5,33,29,-27,33,29,-23,33,-8,6,5,-7,6,-18,0,-7,5,4,-5,5,-3,0,-5,29,-2,33,-3,29,-55,33,-5,6,5,-2,6,5,-3,6,5,-2,6,-20,0,-2,5,4,-10,5,-3,0,-6,29,-2,33,-2,29,-42,33,29,-11,33,-16,6,-19,0,-13,5,-5,0,-6,29,33,-2,29,-42,33,29,-10,33,-5,6,5,-2,6,5,-4,6,5,6,-21,0,-7,5,4,-2,5,4,-2,5,-5,0,-6,29,33,-2,29,-52,33,-15,6,-21,0,-14,5,-5,0,-9,29,-51,33,-5,6,5,-2,6,5,-3,6,5,-3,6,-21,0,-3,5,4,-3,5,4,-6,5,-5,0,-8,29,-36,33,29,-13,33,-16,6,-23,0,-13,5,-7,0,-7,29,-35,33,-2,29,-12,33,-5,6,5,-3,6,5,-6,6,-23,0,-11,5,4,-2,5,-7,0,-9,29,-46,33,-9,6,5,-3,6,5,-3,6,-23,0,-14,5,-8,0,-9,29,-20,33,29,-20,33,-2,29,33,-4,6,5,-11,6,-24,0,-3,5,4,-4,5,4,-6,5,-9,0,-8,29,-11,33,29,-28,33,-2,29,-9,6,5,-3,6,5,-2,6,-2,33,-24,0,-11,5,4,-3,5,-9,0,-10,29,-9,33,29,-2,33,29,-6,33,29,-18,33,29,-5,6,5,-11,6,33,-25,0,-3,5,4,-3,5,4,-7,5,-10,0,-9,29,-37,33,-5,6,5,-4,6,5,-3,6,5,-3,6,-2,33,-24,0,-12,5,4,-3,5,-10,0,-10,29,-12,33,-5,29,-4,33,-2,29,-11,33,-5,6,5,-4,6,5,-7,6,-3,33,-25,0,-4,5,4,-11,5,-11,0,-10,29,-5,33,-2,29,33,29,-3,33,-4,29,-3,33,-2,29,-10,33,-18,6,-5,33,-25,0,-8,5,4,-8,5,-10,0,-12,29,-2,33,-2,29,33,-2,29,-5,33,-3,29,-2,33,29,-3,33,29,-6,33,-5,6,5,-4,6,5,-5,6,5,6,-5,33,-26,0,-4,5,4,-8,5,4,-4,5,-10,0,-12,29,33,29,-2,33,29,-6,33,-3,29,-2,33,29,-3,33,29,-4,33,-10,6,5,-8,6,-5,33,-27,0,-8,5,4,-9,5,-11,0,-12,29,-3,33,29,-6,33,-4,29,-5,33,29,-2,33,-6,6,5,-4,6,5,-4,6,5,-3,6,-6,33,-27,0,-19,5,-10,0,-13,29,33,-2,29,-7,33,-3,29,-6,33,-6,6,5,-4,6,5,-3,6,5,-4,6,-6,33,-29,0,-9,5,4,-9,5,-11,0,-15,29,-7,33,-3,29,-3,33,-22,6,-7,33,-29,0,-4,5,4,-9,5,4,-5,5,-10,0,-15,29,-7,33,-3,29,33,-7,6,5,-5,6,5,-4,6,5,-3,6,-8,33,-30,0,-10,5,4,-11,5,-10,0,-15,29,-6,33,-13,6,5,-9,6,-9,33,-31,0,-15,5,4,-7,5,-10,0,-15,29,-3,33,-9,6,5,-10,6,5,-2,6,-9,33,29,33,-32,0,-5,5,4,-4,5,4,-5,5,4,-9,5,-6,0,-14,29,-10,6,5,-5,6,5,-9,6,-8,33,-2,29,-34,0,-29,5,-5,0,-4,29,-15,6,5,-5,6,5,-5,6,5,-4,6,-9,33,-2,29,-36,0,-10,5,4,-6,5,4,-14,5,-16,6,5,-18,6,-11,33,29,-38,0,-4,5,4,-14,5,4,-12,5,-12,6,5,-9,6,5,-5,6,5,-4,6,-12,33,-39,0,-10,5,4,-12,5,4,-9,5,-8,6,5,-8,6,5,-6,6,5,-5,6,-12,33,-42,0,-11,5,4,-14,5,4,-2,5,4,-3,5,-2,6,5,-10,6,5,-11,6,-14,33,-44,0,-6,5,4,-6,5,4,-20,5,-9,6,5,-8,6,5,-3,6,-9,33,-3,29,-2,33,-47,0,-15,5,4,-2,5,4,-13,5,4,5,-2,6,5,-2,6,5,-6,6,5,-7,6,-3,29,-7,33,-53,0,-6,5,4,-14,5,4,-3,5,4,-2,5,4,-6,5,-15,6,-8,29,-3,33,-56,0,-8,5,4,-26,5,-5,6,5,-5,6,-10,29,-62,0,-8,5,4,-22,5,4,-3,5,-5,6,-78,0,-8,5,4,-2,5,4,-10,5,4,-2,5,4,-9,5,-2,6,-82,0,-10,5,4,-2,5,4,-2,5,4,-11,5,-92,0,-18,5,-102,0,-9,5,-85,0]},{name:"toast",bounds:[0,99,0,12,0,0],size:[100,13],data:[-3,0,-94,15,-6,0,-94,15,-6,0,-94,15,-3,0,-1e3,9]},{name:"pillar",bounds:[0,11,0,5,0,4],size:[12,6],data:[-3,0,-8,6,0,-12,6,5,-10,6,5,3,-4,5,-4,6,-2,5,-2,3,-4,4,-6,5,3,0,-4,4,-4,5,-4,0,-8,6,-3,0,-12,6,-3,5,-8,6,5,3,-2,4,-4,5,-4,6,-2,3,-6,4,-4,5,3,-3,0,-4,4,-4,5,-2,0,-10,6,0,-12,6,5,-10,6,5,3,4,-8,5,6,-3,3,-8,4,5,3,0,3,-8,4,5,-2,0,-5,6,-6,0,-3,5,-6,6,-3,0,3,-2,4,-3,5,-5,6,5,-2,3,-4,4,-3,5,-2,6,-3,3,-7,4,-2,5,3,0,3,-7,4,-2,5,-7,0,-5,6,-4,0,-6,6,-2,5,3,5,-5,6,-5,5,-2,3,4,-4,5,-3,4,-2,5,-3,3,-7,4,-2,5,3,0,3,-7,4,-2,5,0]}],palette:[2037811,2829890,4278361,6844794,9478568,11979727,16777215,16564106,11894871,9064510,6044225,13185080,14576184,16756027,16770454,16578912,11851333,5358655,3185763,2321786,2510702,2307683,4289169,5018541,6537929,9753300,12123647,3942720,4597596,8545409,16229515,12743042,8727910]};function s(t){const s=[];for(let i=0;i<t.length;i+=1)if(t[i]<0){for(let e=t[i];e<0;e+=1)s.push(t[i+1]);i+=1}else s.push(t[i]);return s}function i({data:t,size:s},i,e,n){return t[i+e*s[0]+n*s[0]*s[1]]}function e(t){return[(t>>16)%256,(t>>8)%256,t%256]}function n(t,s,i,n){if(0===n)return;const[o,h,a]=e(i[n-1]);t[s]=o,t[s+1]=h,t[s+2]=a,t[s+3]=255}function o(t,s,e,o){const[h,a]=t.size,r=s[1]-s[0]+1,l=s[3]-s[2]+1,c=document.createElement("canvas");c.width=r,c.height=l;const d=c.getContext("2d"),u=d.createImageData(h,a);for(let a=s[0];a<=s[1];a+=1)for(let r=s[2];r<=s[3];r+=1)n(u.data,4*(a+r*h),o,i(t,a,r,e));return d.putImageData(u,-s[0],-s[2]),c}function h(t,s){const i=[],{bounds:e}=t;for(let n=e[4];n<=e[5];n+=1)i[n]=o(t,e,n,s);return i}const a=new Map;function r(t,s=0){return a.get(t)[s]}const l=[];function c(t){return l[t]}!function(){for(const i of t.parts)i.data=s(i.data),a.set(i.name,h(i,t.palette));for(const s of t.palette)l.push(`rgb(${(i=e(s))[0]}, ${i[1]}, ${i[2]})`);var i}();const d=2,u=1e3,m=1e3,w=15e3,p=w+1250,f=p+150,g=r("toast"),y=g.height*d,x=g.width*d;class M{constructor(t,s){this.x=t,this.y=s}add({x:t,y:s}){return new M(this.x+t,this.y+s)}sub({x:t,y:s}){return new M(this.x-t,this.y-s)}scale(t,s=t){return new M(this.x*t,this.y*s)}rotate(t){return new M(this.x*Math.cos(t)-this.y*Math.sin(t),this.x*Math.sin(t)+this.y*Math.cos(t))}distance({x:t,y:s}){return((this.x-t)**2+(this.y-s)**2)**.5}round(){return new M(Math.round(this.x),Math.round(this.y))}wrap(){for(;this.x<-u/2;)this.x+=u;for(;this.x>u/2;)this.x-=u;return this}static intersection({x:t,y:s},{x:i,y:e},{x:n,y:o},{x:h,y:a}){const r=(a-o)*(i-t)-(h-n)*(e-s);if(0===r)return null;const l=((h-n)*(s-o)-(a-o)*(t-n))/r,c=((i-t)*(s-o)-(e-s)*(t-n))/r;return l>=0&&l<=1&&c>=0&&c<=1?new M(t+l*(i-t),s+l*(e-s)):null}}class P extends M{constructor(t,s,i){super(t,s),this.timestamp=i}static fromPoint(t,s){return new P(t.x,t.y,s)}}const b=new M(u/2,m/2),v=m/15,k=f-m/2+20*d,z={absolute:!1,globalAlpha:1,lineJoin:"round",lineWidth:3,r:0,z:1};const I=new M(.5,20),C=30,E=Math.ceil(m/C),S=.95*u;class T{constructor(t=1){this.pointCache=new Map,this.z=t}draw(t){const s=this.getMinimumY(t.camera);this.trimExcess(s),this.ensureEnough(s);const i=Math.min(.01*Math.abs(t.dy),1);for(const s of this.pointCache.values())this.drawOne(t,s,i)}getMinimumY(t){return Math.floor((t.y-m/2)/C)}trimExcess(t){for(const s of this.pointCache.keys())s<t&&this.pointCache.delete(s)}ensureEnough(t){const s=t+E;for(let i=t;i<=s;i+=1)this.ensurePoint(i)}ensurePoint(t){this.pointCache.has(t)||this.pointCache.set(t,new M(Math.random()*S-S/2,t*C))}drawOne(t,s,i){t.rect(s.sub(I),s.add(I),{fillStyle:c(26),globalAlpha:i,z:this.z})}}const R=1.5*m,A=[r("pillar"),r("pillar",1),r("pillar",2),r("pillar",3),r("pillar",4)],O=.02,D=R/5/d,L=4;function F(t,s,i,e){const{width:n,height:o}=s;t.drawImage(s,0,L+1,n,o,i,e+L+D,n,o),t.drawImage(s,0,L,n,1,i,e+L,n,D),t.drawImage(s,i,e)}const H=document.createElement("canvas");!function(){const t=function(){const t=[],s=R/6,i=R/2,e=R-i,n=u;for(let o=s;o<i+e;o+=16)for(let e=0-50*Math.random();e<n+50;e+=36+24*Math.random()){const h=1-(o/i)**5;Math.abs(e-n/2)/(n/2)>h&&Math.random()<.75&&t.push([new M(e,o-s+12*Math.random()),A[Math.floor(Math.random()*A.length)]])}return t}();H.width=u/d,H.height=R/d;const s=H.getContext("2d");s.imageSmoothingEnabled=!1;for(const[i,e]of t)F(s,e,(i.x-e.width)/d,(i.y-e.height)/d)}();const G=new M(0,0),V=new M(u,m),Y=r("planet"),$=.0015,j=new M(u/3/$,-m/3/$),q=.002,B=u/2/q,J=m/q,W=new M(-B,m/2.5/q),X=new M(B,J);function K(t){t.rect(G,V,{absolute:!0,fillStyle:c(23)}),t.image(Y,j,{z:$}),t.rect(W,X,{fillStyle:c(22),z:q}),function(t){t.image(H,new M(0,(R+m/3)/2/O),{z:O})}(t)}const N=5*d,Q=1.1*x,U=1500,Z=f+m/4;class _{constructor(){this.glowIntensity=0}tick(t){var s,i;this.glowIntensity=(s=(1-Math.abs(t%U/(U/2)-1))**.5,i=.1,Math.round(s/i)*i)}drawGlowyRect(t,s,i,e,n){t.rect(s,i,{fillStyle:e}),t.rect(s,i,{fillStyle:n,globalAlpha:this.glowIntensity})}draw(t){t.rect(new M(-u/2,f),new M(u/2,Z),{fillStyle:c(4)}),this.drawGlowyRect(t,new M(-Q/2,f),new M(Q/2,f+N),c(5),c(6)),this.drawGlowyRect(t,new M(-u/2,f),new M(-(Q+x)/2,Z),c(10),c(11)),this.drawGlowyRect(t,new M((Q+x)/2,f),new M(u/2,Z),c(10),c(11))}}const tt=r("toast"),st=1.2,it=.002,et=1e-6,nt=.05,ot=.001,ht=25e-5,at=32,rt=.2,lt=1e-5,ct=[new M(-x/2,-y/2),new M(-x/2,y/2),new M(x/2,y/2),new M(x/2,-y/2)];function dt(t){return t.y>f}class ut{constructor(t=0,s=0){this.collisionPoint=null,this.dr=Math.sign(Math.random()-.5)*(.01*Math.random()+.005),this.dx=Math.sign(Math.random()-.5)*(.05*Math.random()+.025),this.dy=st,this.lastPhase=!1,this.mid=new M(t,s),this.r=0}tick(t){const s=this.mid.x,i=this.mid.y,e=this.r;if(null!==this.collisionPoint&&this.handleCollision(this.collisionPoint,t),!this.lastPhase){this.mid.x+=this.dx*t,this.mid.y+=this.dy*t,this.r+=this.dr*t,this.wrap(),this.dy=this.dy*(1-it*t)+st*it*t,this.dr=this.dr*(1-et*t)+Math.sign(Math.PI-this.r)*nt*et*t;const n=1-t**this.getDampeningPower();if(this.dx*=n,this.dy*=n,this.dr*=n,this.isColliding()){const[n,o]=this.findCollisionPoint(s,i,e,t);this.collisionPoint=n,this.handleCollision(this.collisionPoint,o)}}}getDampeningPower(){return-3*(this.mid.y<w?1:this.mid.y<p?((p-this.mid.y)/(p-w))**.5*.8:1)}isColliding(){return this.getTransformedPoints().some(dt)}findCollisionPoint(t,s,i,e){let n=this.mid,o=0,h=e;for(let e=0;e<at;e+=1){const e=(o+h)/2;this.mid.x=t+this.dx*e,this.mid.y=s+this.dy*e,this.r=i+this.dr*e,this.wrap();const a=this.getTransformedPoints().find(dt);a?(h=e,n=a):o=e}return this.mid.y+=f-n.y,n.y=f,[n,e-h]}handleCollision(t,s,i=!1){const e=t.sub(this.mid).wrap();if(this.lastPhase){const t=this.getIntersection(this.mid,new M(this.mid.x,f+1));null!==t&&(this.dr-=s/100*ht*Math.sign(e.x)*Math.max(f-t.y,0)**.6)}else this.dx=0,this.dy=0,this.dr=ht*-Math.sign(e.x),this.lastPhase=!0;const n=this.dr*s,o=this.getClosestRightAngle();if(Math.sign(this.r-o)===Math.sign(this.r+n-o)||i){const t=e.rotate(n).sub(e);this.mid=this.mid.sub(t),this.mid.y=Math.min(this.mid.y,f-y/2),this.r+=n,this.wrap()}else{const i=(o-this.r)/this.dr;this.handleCollision(t,i,!0),this.collisionPoint=t.sub(this.mid).scale(-1,1).add(this.mid),this.dr*=rt,Math.abs(this.dr)<lt&&(this.dr=0,this.collisionPoint=new M(this.mid.x,f)),this.handleCollision(this.collisionPoint,s-i,!0)}}getClosestRightAngle(){const t=.25*Math.PI;for(const s of[0,.5*Math.PI,Math.PI,1.5*Math.PI])if(Math.abs(this.r-s)<=t)return s;return 2*Math.PI}tryApplyForce(t){if(null===t)return null;const[s,i]=t;if(null===this.getIntersection(this.mid,s))return null;const e=this.getIntersection(s,i);if(null===e)return null;const n=e.sub(s).scale(ot),o=e.sub(this.mid);return this.applyForce(o,n),e}getIntersection(t,s){const i=this.getTransformedPoints();i.push(i[0]);let e=null;for(let n=0;n<i.length-1;n+=1){const o=M.intersection(t,s,i[n],i[n+1]);if(null!==o){t.distance(o)<1/0&&(e=o)}}return e}getTransformedPoints(){return ct.map(t=>t.rotate(this.r).add(this.mid))}applyForce({x:t,y:s},{x:i,y:e}){this.dx+=i,this.dy+=e,this.dr+=(t*e-s*i)*ht}wrap(){for(this.mid.wrap();this.r>2*Math.PI;)this.r-=2*Math.PI;for(;this.r<0;)this.r+=2*Math.PI}draw(t){t.image(tt,this.mid,{r:this.r})}}const mt=20;const wt=1,pt=20,ft=5,gt=80,yt=400,xt=2*yt,Mt=.05*yt,Pt={basic:r("sparkles",0),hit:r("sparkles",1)};class bt extends P{constructor(t,s,i){super(t.x+(Math.random()-.5)*gt,t.y+(Math.random()-.5)*gt,t.timestamp+s),this.r=Math.random()*Math.PI,this.dx=(Math.random()-.5)*gt/yt,this.dy=(Math.random()-.5)*gt/yt,this.dr=Math.random()/100,this.isHit=i}isExpired(t){return t-this.timestamp>(this.isHit?xt:yt)}tick(t){this.x+=this.dx*t,this.y+=this.dy*t,this.r+=this.dr*t;const s=1-t**-1.5;this.dx*=s,this.dy*=s,this.dr*=s}draw(t,s){const i=this.isHit?Pt.hit:Pt.basic,e=function(t,s){return s<Mt?s/Mt:(t-s)/(t-Mt)}(this.isHit?xt:yt,s-this.timestamp)**.5,n=this.isHit?1:.5;t.image(i,new M(this.x,this.y),{absolute:!0,globalAlpha:e*n,r:this.r})}}class vt{constructor(){this.now=-1/0,this.sparkles=new Set}add(t,s=!1){for(let i=0;i<(s?pt:wt);i+=1)this.sparkles.add(new bt(t,ft*i,s))}tick(t,s){this.now=t,this.removeOldSparkles(),this.updateSparkles(s)}removeOldSparkles(){const t=[];for(const s of this.sparkles)s.isExpired(this.now)&&t.push(s);for(const s of t)this.sparkles.delete(s)}updateSparkles(t){for(const s of this.sparkles)s.tick(t)}draw(t){for(const s of this.sparkles)s.draw(t,this.now)}}const kt=[r("wizard"),r("wizard",1),r("wizard",2),r("wizard",3),r("wizard",4)],zt=new M(u/2,m/4),It=1,Ct=kt.length-1-It,Et=80,St=2*Math.PI*35e-5,Tt=8;class Rt{constructor(){this.offset=-1/0,this.phase=0,this.startTimestamp=0}tick(t,s){if(this.offset=Math.sin(t*St)*Tt,s){const s=Math.floor((t-this.startTimestamp)/Et);0===this.phase?(this.startTimestamp=t,this.phase=1):this.phase<It?this.phase=s%It+1:this.phase=(s-It)%Ct+It+1}else this.phase=0}draw(t){const s=zt.add(new M(0,this.offset));t.image(kt[0],s,{absolute:!0}),this.phase>0&&t.image(kt[this.phase],s,{absolute:!0})}}const At=120;document.documentElement.style.background=c(1);const Ot=new class{constructor(){this.camera=new M(0,v),this.canvas=canvas,this.canvas.width=u,this.canvas.height=m,this.context=canvas.getContext("2d"),this.context.imageSmoothingEnabled=!1,this.dy=0}trackToast(t){const s=t.mid.y,i=Math.max(Math.min((s-w)/(p-w),1),0),e=Math.min(k*i+(s+v)*(1-i),s+v);this.dy=e-this.camera.y,this.camera.y=e}getOffset(){return b.sub(this.camera)}rect(t,s,i){const{absolute:e,r:n,z:o,...h}={...z,...i};Object.assign(this.context,h);const{x:a,y:r}=this.getTransformedPoint(e,t,o),{x:l,y:c}=this.getTransformedPoint(e,s,o);this.setRotation(0),this.context.beginPath(),this.context.rect(a,r,l-a,c-r),this.context.closePath(),h.fillStyle&&this.context.fill(),h.strokeStyle&&this.context.stroke()}image(t,s,i){const{absolute:e,r:n,z:o,...h}={...z,...i};Object.assign(this.context,h);const{x:a,y:r}=this.getTransformedPoint(e,s,o),l=t.width*d,c=t.height*d;this.setRotation(n,a,r),this.context.drawImage(t,a-l/2,r-c/2,l,c),a<u/2?(this.setRotation(n,a+u,r),this.context.drawImage(t,a-l/2+u,r-c/2,l,c)):(this.setRotation(n,a-u,r),this.context.drawImage(t,a-l/2-u,r-c/2,l,c))}getTransformedPoint(t,s,i){return t?s.round():s.sub(this.camera).scale(i).add(b).round()}setRotation(t,s=0,i=0){const e=Math.cos(t),n=Math.sin(t);this.context.setTransform(e,n,-n,e,s*(1-e)+i*n,i*(1-e)-s*n)}clear(){this.context.clearRect(0,0,u,m)}},Dt=new class{constructor(){this.lastPoint=null,this.now=-1/0,this.points=new Set,this.pressed=!1,this.sparkles=new vt,this.wizard=new Rt}init(t){t.canvas.addEventListener("mousedown",s=>{s.preventDefault(),this.start(s,t)}),t.canvas.addEventListener("touchstart",s=>{s.preventDefault(),this.start(this.normalizeTouchEvent(s),t)}),t.canvas.addEventListener("mousemove",s=>{s.preventDefault(),this.move(s,t)}),t.canvas.addEventListener("touchmove",s=>{s.preventDefault(),this.move(this.normalizeTouchEvent(s),t)}),window.addEventListener("mouseup",()=>{this.stop()}),window.addEventListener("touchend",()=>{this.stop()}),window.document.addEventListener("visibilitychange",()=>{this.stop()}),window.addEventListener("contextmenu",t=>{t.preventDefault()})}normalizeTouchEvent(t){return t.touches[0]}start(t,s){this.pressed=!0,this.pushPoint(t,s.canvas)}move(t,s){this.pressed&&this.pushPoint(t,s.canvas)}stop(){this.clearPoints(),this.pressed=!1}pushPoint(t,s){const{left:i,top:e,width:n,height:o}=s.getBoundingClientRect();this.lastPoint=new P((t.clientX-i)*u/n,(t.clientY-e)*m/o,this.now),this.points.add(this.lastPoint),this.sparkles.add(this.lastPoint)}tick(t,s,i,e){if(this.sparkles.tick(t,s),this.wizard.tick(t,this.pressed),this.now=t,!this.pressed)return;this.removeOldPoints();const n=this.getIntersectionPoint(e,i);null!==n&&(this.sparkles.add(P.fromPoint(n.add(i),t),!0),this.clearPoints())}getIntersectionPoint(t,s){const i=t.tryApplyForce(this.getCurrentVector(s));return null!==i?i:null===this.lastPoint?null:t.tryApplyForce(this.getCurrentVector(s.sub(new M(this.lastPoint.x<u/2?u:-u,0))))}getCurrentVector(t){if(this.points.size<2||null===this.lastPoint)return null;const[s]=this.points;return[s.sub(t),this.lastPoint.sub(t)]}removeOldPoints(){const t=[];for(const s of this.points)s.timestamp<this.now-At&&t.push(s);for(const s of t)this.points.delete(s);0===this.points.size&&(this.lastPoint=null)}clearPoints(){this.points=new Set,this.lastPoint=null}draw(t){this.sparkles.draw(t),this.wizard.draw(t)}};Dt.init(Ot),function({display:t,mouse:s}){const i=new ut,e=new _,n=[new T,new T(2),new T(3),i,e,s];let o=0,h=!0;requestAnimationFrame(function a(r){requestAnimationFrame(a);const l=Math.min(r-o,mt);if(o=r,h)h=!1;else{t.clear(),i.tick(l),e.tick(r),t.trackToast(i),s.tick(r,l,t.getOffset(),i),K(t);for(const s of n)s.draw(t,i)}})}({display:Ot,mouse:Dt});</script>
